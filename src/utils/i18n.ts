import type { TranslationKeys, LanguageCode, TranslationSet } from '../types/i18n';

export const translations: TranslationSet = {
  ru: {
    // Navigation
    'nav.home': 'Главная',
    'nav.dashboard': 'Мои результаты',
    'nav.admin': 'Администрирование',
    'nav.editor': 'Редактор',
    'nav.translations': 'Переводы',
    'nav.profile': 'Профиль',
    
    // User setup
    'user.title': 'Добро пожаловать',
    'user.subtitle': 'Для начала работы, пожалуйста, представьтесь',
    'user.placeholder': 'Введите ваше имя',
    'user.error.empty': 'Пожалуйста, введите ваше имя',
    'user.error.short': 'Имя должно содержать минимум 2 символа',
    'user.continue': 'Продолжить',
    'user.archive.title': 'Ранее сохраненные пользователи',
    'user.archive.empty': 'Архив пользователей пока пуст.',
    'user.archive.select': 'Выберите пользователя для продолжения работы без backup файла.',
    'user.archive.use': 'Войти как {name}',
    'user.archive.restoring': 'Восстановление...',
    'user.archive.lastUsed': 'Последняя активность: {date}',
    'user.archive.role': 'Роль: {role}',
    'user.archive.error': 'Не удалось восстановить пользователя из локального архива.',
    'user.backup.title': 'Войти из файла профиля',
    'user.backup.description': 'Загрузите сохраненный файл профиля, чтобы восстановить данные на этом или другом устройстве.',
    'user.backup.success': 'Профиль и данные успешно загружены из файла профиля.',
    'user.backup.error': 'Не удалось загрузить файл профиля.',
    
    // Questionnaire list
    'quiz.title': 'Привет, {name}!',
    'quiz.subtitle': 'Выберите опросник для прохождения',
    'quiz.questions': 'вопросов',
    'quiz.scale': 'Шкала: 0-10',
    'quiz.start': 'Начать опрос',
    'quiz.noQuizzes': 'Нет доступных опросников',
    'quiz.loading.title': 'Загружаем опросники...',
    'quiz.loading.retrying': 'Повторная попытка загрузки ({attempt}/{max})',
    'quiz.loading.retryingHint': 'Проверяем наличие опросников на сервере.',
    'quiz.loading.partialTitle': 'Серверные опросники временно недоступны',
    'quiz.loading.partialDescription': 'Показаны только локальные опросники. Когда сервер ответит, список обновится автоматически.',
    'quiz.loading.failedTitle': 'Не удалось загрузить опросники',
    'quiz.loading.failedDescription': 'Сервер пока не отвечает. Проверьте подключение и повторите попытку.',
    'quiz.loading.autoRetry': 'Автоповтор через {seconds} сек.',
    'quiz.loading.retryButton': 'Повторить сейчас',
    'quiz.paused.title': 'У вас есть приостановленный опрос',
    'quiz.paused.description': 'Вы можете продолжить с того места, где остановились',
    'quiz.paused.continue': 'Продолжить',
    
    // Quiz taker
    'quiz.question': 'Вопрос',
    'quiz.of': 'из',
    'quiz.sources': 'Источники:',
    'quiz.selfCheck.show': 'Показать подсказки для самопроверки',
    'quiz.selfCheck.hide': 'Скрыть подсказки',
    'quiz.selfCheck.title': 'Вопросы для самопроверки:',
    'quiz.score.select': 'Выберите оценку:',
    'quiz.score.selected': 'Выбрано',
    'quiz.score.preview': 'Предпросмотр',
    'quiz.comment.add': 'Добавить комментарий',
    'quiz.comment.required': 'Письменный комментарий обязателен для этого вопроса',
    'quiz.comment.requiredHint': 'Чтобы продолжить, добавьте письменный комментарий к ответу.',
    'quiz.comment.placeholder': 'Ваши мысли, наблюдения, комментарии...',
    'quiz.photo.add': 'Добавить фото',
    'quiz.photo.remove': 'Удалить фото',
    'quiz.navigation.back': 'Назад',
    'quiz.navigation.pause': 'Пауза',
    'quiz.navigation.next': 'Далее',
    'quiz.navigation.complete': 'Завершить',
    
    // Dashboard
    'dashboard.title': 'Личный кабинет',
    'dashboard.subtitle': 'Просмотр и управление вашими результатами',
    'dashboard.empty.title': 'Пока нет результатов',
    'dashboard.empty.description': 'Пройдите опрос, чтобы увидеть свои результаты здесь',
    'dashboard.results.count': 'Мои результаты ({count})',
    'dashboard.export.all': 'Экспортировать все',
    'dashboard.score.total': 'Общий балл',
    'dashboard.score.percentage': 'Процент',
    'dashboard.answered': 'Отвечено',
    'dashboard.date': 'Дата',
    'dashboard.export': 'Экспортировать',
    'dashboard.delete': 'Удалить',
    'dashboard.import.button': 'Импорт результатов',
    'dashboard.import.strategy.skip': 'Импорт: пропускать дубликаты',
    'dashboard.import.strategy.replace': 'Импорт: заменять дубликаты',
    'dashboard.transfer.defaults': 'Формат обмена по умолчанию: JSON. При импорте дубликаты заменяются автоматически.',
    'dashboard.import.success': 'Импорт завершен. Всего: {total}, добавлено: {imported}, заменено: {replaced}, пропущено: {skipped}, невалидно: {invalid}.',
    'dashboard.import.error': 'Не удалось импортировать результаты.',
    'dashboard.report.create': 'Подготовить отчет по оценке',
    'dashboard.report.hide': 'Скрыть отчет',
    'dashboard.report.title': 'Отчет по оценке: {title}',
    'dashboard.report.description': 'Отчет формируется для одной оценки. Пустые комментарии и фото не выводятся.',
    'dashboard.report.download': 'Скачать',
    'dashboard.report.downloadMarkdown': 'Скачать текст',
    'dashboard.report.downloadPlainText': 'Скачать текст без оформления',
    'dashboard.report.downloadHtml': 'Скачать HTML',
    'dashboard.report.savePdf': 'Сохранить PDF',
    'dashboard.report.savePdfHint': 'PDF открывается через окно печати браузера. Выберите "Сохранить как PDF".',
    'dashboard.report.print': 'Печать',
    'dashboard.report.close': 'Закрыть отчет',
    'dashboard.report.preview': 'Предпросмотр отчета',
    'dashboard.report.error.print': 'Не удалось открыть окно печати отчета.',
    'dashboard.report.error.pdf': 'Не удалось сформировать PDF-файл отчета.',
    'dashboard.group.summary': 'Попыток: {attempts} • Последняя дата: {date}',
    'dashboard.group.overall': 'Общая оценка по опроснику',
    'dashboard.group.history': 'История прохождений по опроснику',
    'dashboard.group.absentQuestions': 'Вопросы, отсутствующие в текущей версии, помечены цветной рамкой.',
    'dashboard.group.absentBadge': 'отсутствует в текущей версии',
    'dashboard.group.openQuestionnaire.action': 'Редактировать опрос',
    'dashboard.group.openQuestionnaire.errorSchema': 'Не найден опросник для редактирования этой оценки.',
    'dashboard.tab.results': 'Результаты',
    'dashboard.tab.analytics': 'Аналитика',
    'dashboard.tab.feedback': 'Обратная связь',
    'dashboard.analytics.title': 'Аналитика динамики',
    'dashboard.analytics.subtitle': 'Отдельная вкладка для анализа изменений оценок и истории по вопросам.',
    'dashboard.analytics.usage': 'Открыто за все время: {count}',
    'dashboard.analytics.filter.questionnaire': 'Опросник',
    'dashboard.analytics.filter.period': 'Быстрый период',
    'dashboard.analytics.filter.quickPeriod': 'Быстрые кнопки',
    'dashboard.analytics.filter.from': 'С даты',
    'dashboard.analytics.filter.to': 'По дату',
    'dashboard.analytics.filter.quick7': '7 дней',
    'dashboard.analytics.filter.quick30': '30 дней',
    'dashboard.analytics.filter.quickAll': 'Все время',
    'dashboard.analytics.filter.rangePlaceholder': 'Выберите период',
    'dashboard.analytics.filter.clear': 'Очистить',
    'dashboard.analytics.emptyByFilter': 'Нет результатов для выбранного опросника и периода.',
    'dashboard.analytics.rangeInvalid': 'Начало периода позже конца. Проверьте даты.',
    'dashboard.feedback.title': 'Обратная связь куратора',
    'dashboard.feedback.subtitle': 'Отдельная вкладка с историей комментариев куратора и ответов студента.',
    'dashboard.feedback.empty': 'Пока нет обратной связи от куратора в загруженных результатах.',
    'dashboard.feedback.question': 'Вопрос {index}',
    'dashboard.feedback.thread': 'Переписка',
    'dashboard.feedback.reply.placeholder': 'Ваш ответ куратору, уточнение или дополнение...',
    'dashboard.feedback.reply.save': 'Сохранить ответ студенту',
    'dashboard.feedback.comment.label': 'Описание студента к ответу',
    'dashboard.feedback.comment.placeholder': 'Добавьте или скорректируйте описание вашего ответа...',
    'dashboard.feedback.comment.save': 'Сохранить описание',
    'dashboard.feedback.author.curator': 'Куратор',
    'dashboard.feedback.author.student': 'Студент',
    'dashboard.feedback.saved': 'Изменения сохранены.',
    'dashboard.feedback.openQuestion.action': 'Открыть вопрос',
    'dashboard.feedback.openQuestion.errorSchema': 'Не найден опросник для редактирования этого вопроса.',
    'dashboard.feedback.openQuestion.errorQuestion': 'Не найден ответ по этому вопросу в результате.',

    // Admin dashboard
    'admin.title': 'Администрирование',
    'admin.subtitle': 'Единый профиль для управления опросниками, переводами и операциями миграции/сверки.',
    'admin.tab.overview': 'Обзор',
    'admin.tab.questionnaires': 'Опросники',
    'admin.tab.translations': 'Переводы',
    'admin.tab.operations': 'Миграции и сверка',
    'admin.ops.migrations.title': 'Миграции данных',
    'admin.ops.migrations.description': 'Принудительный запуск миграций локального хранилища.',
    'admin.ops.migrations.run': 'Запустить миграции',
    'admin.ops.status.migrations.success': 'Миграции выполнены успешно.',
    'admin.ops.error.migrations.failed': 'Не удалось выполнить миграции.',
    'admin.ops.reconciliation.title': 'Сверка импорта (dry-run)',
    'admin.ops.reconciliation.description': 'Проверка совместимости файла результатов с текущими схемами опросников до импорта.',
    'admin.ops.reconciliation.file': 'Файл с результатами',
    'admin.ops.error.reconciliation.emptyFile': 'Файл не содержит результатов для сверки.',
    'admin.ops.status.reconciliation.completed': 'Сверка завершена. Проверено результатов: {total}. Совместимо: {compatible}.',
    'admin.ops.error.reconciliation.failed': 'Не удалось выполнить сверку импортируемых результатов.',
    'admin.ops.report.totalResults': 'Результатов в файле: {count}',
    'admin.ops.report.compatibleResults': 'Совместимые: {count}',
    'admin.ops.report.incompatibleResults': 'Несовместимые: {count}',
    'admin.ops.report.missingQuestionnaires': 'Отсутствующие опросники: {count}',
    'admin.ops.report.missingQuestions': 'Отсутствующие вопросы: {count}',
    'admin.overview.editor.description': 'Создание, редактирование и загрузка опросников без redeploy.',
    'admin.overview.translation.description': 'Редактирование и экспорт файлов локализации интерфейса.',
    'admin.overview.operations.description': 'Запуск миграций и dry-run сверка импортируемых результатов.',

    // Questionnaire editor
    'editor.title': 'Редактор опросников',
    'editor.subtitle': 'Создавайте, редактируйте и загружайте опросники. Новые файлы автоматически нормализуются к шкале 0..10.',
    'editor.loadExisting': 'Загрузить существующий',
    'editor.loadExisting.placeholder': 'Выберите опросник...',
    'editor.import': 'Импорт файла',
    'editor.meta.title': 'Название',
    'editor.meta.title.placeholder': 'Оценка качества...',
    'editor.meta.source': 'Источник',
    'editor.meta.source.placeholder': 'Лекция / текст',
    'editor.meta.quality': 'Код опросника',
    'editor.languages.title': 'Языки вопросов:',
    'editor.languages.remove.aria': 'Удалить язык {language}',
    'editor.languages.new.placeholder': 'Код нового языка (например, es)',
    'editor.languages.hint': 'При добавлении языка появятся поля перевода для каждого вопроса.',
    'editor.languages.add': '+ Добавить язык',
    'editor.question.title': 'Вопрос {index}',
    'editor.question.delete': 'Удалить',
    'editor.question.id': 'Код вопроса',
    'editor.question.requiresComment': 'Требовать письменный комментарий для этого вопроса',
    'editor.question.localized': 'Вопрос ({language})',
    'editor.question.contextSources': 'Контекст (по строке)',
    'editor.question.selfCheckPrompts': 'Подсказки для самопроверки (по строке)',
    'editor.error.language.empty': 'Укажите код языка.',
    'editor.error.language.invalid': 'Некорректный код языка. Используйте форматы вида ru, en, es, pt-br.',
    'editor.error.language.duplicate': 'Язык "{language}" уже добавлен.',
    'editor.status.language.added': 'Язык "{language}" добавлен в редактор.',
    'editor.error.language.last': 'Нельзя удалить последний язык.',
    'editor.status.language.removed': 'Язык "{language}" удален из редактора.',
    'editor.status.saved': 'Опросник "{title}" сохранен в локальное хранилище.',
    'editor.status.exported': 'Файл опросника экспортирован.',
    'editor.status.imported': 'Файл "{fileName}" загружен в редактор.',
    'editor.error.deleteCustom.qualityMissing': 'Укажите quality идентификатор перед удалением.',
    'editor.status.deleteCustom.success': 'Кастомный опросник "{quality}" удален из локального реестра.',
    'editor.actions.addQuestion': '+ Добавить вопрос',
    'editor.actions.save': 'Сохранить в приложение',
    'editor.actions.export': 'Экспортировать файл',
    'editor.actions.deleteCustom': 'Удалить кастомный',
    'editor.actions.reset': 'Очистить форму',

    // Translation manager
    'translation.title': 'Инструмент перевода UI',
    'translation.subtitle': 'Отдельный инструмент для формирования и сохранения файлов локализации интерфейса.',
    'translation.language': 'Язык',
    'translation.language.option.ru': 'Русский',
    'translation.language.option.en': 'English',
    'translation.translator': 'Переводчик',
    'translation.translator.placeholder': 'Имя переводчика',
    'translation.import': 'Загрузить файл перевода',
    'translation.json': 'Текст перевода (можно просмотреть и отредактировать)',
    'translation.status.currentLoaded': 'Текущие переводы "{language}" загружены в редактор.',
    'translation.status.loadedForLanguage': 'Подгружены текущие переводы для языка "{language}".',
    'translation.status.fileDownloaded': 'Файл перевода сформирован.',
    'translation.status.fileLoaded': 'Файл перевода загружен в редактор.',
    'translation.error.invalidJson': 'Некорректный JSON в блоке перевода.',
    'translation.error.fileRead': 'Не удалось прочитать файл перевода.',
    'translation.status.importMeta': 'Импортировано: {fileName} | translator: {translator} | version: {version}',
    'translation.keys.title': 'Проверка ключей',
    'translation.keys.noneMissing': 'Отсутствующих ключей не найдено.',
    'translation.actions.loadCurrent': 'Подгрузить текущие',
    'translation.actions.save': 'Скачать файл перевода',
    'translation.actions.exportAll': 'Экспортировать все переводы',
    'translation.audit.title': 'Аудит покрытия переводов форм',
    'translation.audit.summary': 'Форм: {forms} • Полностью покрыто: {covered} • Не хватает ключей (ru+en): {missing}',
    'translation.audit.missingRu': 'Не хватает на RU: {count}',
    'translation.audit.missingEn': 'Не хватает на EN: {count}',
    'translation.audit.exportCoverage': 'Скачать отчет покрытия',
    'translation.audit.table.form': 'Форма',
    'translation.audit.table.keys': 'Ключей',
    'translation.audit.table.missingRu': 'Пробелы RU',
    'translation.audit.table.missingEn': 'Пробелы EN',
    'translation.audit.table.status': 'Статус',
    'translation.audit.status.ok': 'OK',
    'translation.audit.status.needsWork': 'Требует доработки',

    // Questionnaire loader
    'loader.title': 'Загрузка опросника',
    'loader.subtitle': 'Добавьте файл опросника без обновления приложения.',
    'loader.actions.downloadTemplate': 'Скачать шаблон',
    'loader.actions.upload': 'Загрузить файл',
    'loader.status.success': 'Опросник "{title}" загружен и доступен в списке.',
    'loader.status.error': 'Не удалось загрузить файл опросника.',

    // Score chart
    'chart.distribution.title': 'Распределение оценок по шкале 0..10',
    'chart.distribution.subtitle': 'Используется полная шкала оценивания с описанием каждого балла.',
    'chart.timeline.title': 'Общая динамика по дням',
    'chart.timeline.subtitle': 'Календарная навигация по среднему баллу за день по всем ответам.',
    'chart.timeline.hint': 'Выберите день в календаре, чтобы посмотреть детали за конкретную дату.',
    'chart.timeline.empty': 'Для выбранного месяца нет завершенных опросов.',
    'chart.timeline.summary': '{date} • Средний балл: {score}/10 ({grade}). Попыток: {attempts} • Зафиксированных оценок: {answersCount}',
    'questionStats.title': 'Динамика по вопросам выбранного опросника',
    'questionStats.subtitle': 'Показываются только вопросы, по которым есть минимум две оценки в выбранном периоде.',
    'questionStats.select': 'Выбор опросника для динамики вопросов',
    'questionStats.empty': 'Нет данных для выбранного опросника.',
    'questionStats.metric.id': 'ID',
    'questionStats.metric.average': 'Средний балл',
    'questionStats.metric.last': 'Последний балл',
    'questionStats.metric.attempts': 'Попыток',
    'questionStats.metric.delta': 'Изменение',
    'questionStats.dynamics.title': 'История изменения оценки',
    'questionStats.dynamics.noData': 'Для выбранного периода пока нет вопросов с двумя и более оценками.',
    'questionStats.lowData.title': 'Вопросы с недостатком данных ({count})',
    'questionStats.lowData.item': '{question} — попыток: {attempts}',
    
    // Grading scale
    'grade.0': 'не задумывался (отсутствие осознанности)',
    'grade.1': 'когда вспоминаю, стараюсь, но уже поздно',
    'grade.2': 'почти никогда не получается',
    'grade.3': 'часто почти не получается',
    'grade.4': 'получается редко, требует огромных усилий',
    'grade.5': 'стараюсь, получается не всегда (50/50)',
    'grade.6': 'получается чаще, чем не получается',
    'grade.7': 'иногда получается стабильно (уверенная практика)',
    'grade.8': 'получается в большинстве случаев',
    'grade.9': 'почти всегда получается',
    'grade.10': 'всегда (совершенство)',
    
    // Common
    'common.loading': 'Загрузка...',
    'common.close': 'Закрыть',
    'common.save': 'Сохранить',
    'common.cancel': 'Отмена',
    'common.delete': 'Удалить',
    'common.edit': 'Редактировать',
    'common.back': 'Назад',
    'markdown.toolbar.bold': 'Жирный',
    'markdown.toolbar.italic': 'Курсив',
    'markdown.toolbar.bulletList': 'Маркированный список',
    'markdown.toolbar.orderedList': 'Нумерованный список',
    'markdown.toolbar.image': 'Вставить изображение',
    'markdown.toolbar.undo': 'Отменить',
    'markdown.toolbar.redo': 'Повторить',
    'header.role.student': 'Студент',
    'header.role.curator': 'Куратор',
    'header.role.admin': 'Админ',
    'header.logout': 'Выйти',
    'header.loggingOut': 'Выход...',
    'header.logoutError': 'Не удалось выгрузить данные и завершить сессию.',
    'header.logoutConfirmTitle': 'Подтвердите выход',
    'header.logoutConfirm': 'Точно выйти из приложения?',
    'header.logoutContinue': 'Продолжить',
    'header.logoutStay': 'Остаться',
    'header.logoutBackupTitle': 'Сохраните файл профиля',
    'header.logoutSaveWarning': 'Будет сформирован файл профиля (backup JSON). Сохраните его и не отменяйте загрузку: этот файл можно загрузить на другом устройстве для восстановления данных.',
    'header.logoutBackupAction': 'Скачать файл и выйти',
    'access.denied.title': 'Доступ ограничен',
    'access.denied.editorOnlyAdmin': 'Редактор опросников доступен только для роли admin.',
    'access.denied.translationsOnlyAdmin': 'Панель переводов доступна только для роли admin.',
    'pwa.updates.title': 'Доступны новые опросники',
    'pwa.updates.body': 'На сервере опубликованы новые опросники ({count}): {names}.',

    // Curator dashboard
    'curator.title': 'Панель куратора',
    'curator.subtitle': 'Проверка ответов студентов с группировкой по опроснику и студенту.',
    'curator.metrics.totalAnswers': 'Всего ответов',
    'curator.metrics.groupCount': 'Групп заданий',
    'curator.metrics.pending': 'Ожидают проверки',
    'curator.metrics.reviewed': 'Проверено',
    'curator.metrics.averageScore': 'Средний балл',
    'curator.section.activeGroups': 'Группы с активной проверкой ({count})',
    'curator.section.completedGroups': 'Группы завершенных проверок ({count})',
    'curator.empty.activeGroups': 'Нет активных групп, ожидающих проверку.',
    'curator.group.summary': 'Попыток: {total} • Ожидают: {pending} • Проверено: {reviewed}',
    'curator.group.reviewedSummary': 'Проверенных попыток: {count}',
    'curator.status.pending': 'Ожидает проверки',
    'curator.status.inReview': 'На проверке',
    'curator.status.reviewed': 'Проверено',
    'curator.status.needsRevision': 'На доработку',
    'curator.status.approved': 'На доработку',
    'curator.actions.hide': 'Скрыть',
    'curator.actions.review': 'Проверить',
    'curator.actions.markReviewed': 'Отметить как проверено',
    'curator.actions.requestRevision': 'Отправить на доработку',
    'curator.actions.approve': 'Отправить на доработку',
    'curator.question.label': 'Вопрос {index}:',
    'curator.question.absent': 'отсутствует в текущей версии',
    'curator.schema.absentQuestions': 'В текущей версии опросника отсутствуют вопросы: {questions}',
    'curator.comment.student': 'Комментарий студента:',
    'curator.photos.attached': 'Прикрепленные фото:',
    'curator.feedback.add': '+ Добавить обратную связь',
    'curator.feedback.send': 'Отправить',
    'curator.feedback.cancel': 'Отмена',
    'curator.feedback.placeholder': 'Ваш комментарий, вопросы, дополнения...',
    'curator.ops.exportFormat': 'Формат экспорта',
    'curator.ops.importStrategy': 'Стратегия импорта',
    'curator.ops.exportAllReviewed': 'Экспортировать все проверенные',
    'curator.ops.importStudentAnswers': 'Загрузить ответы студентов',
    'curator.ops.exportForStudent': 'Экспорт проверенных для студента',
    'curator.ops.export.json': 'JSON',
    'curator.ops.export.csv': 'CSV',
    'curator.ops.import.skip': 'Пропускать дубликаты',
    'curator.ops.import.replace': 'Заменять дубликаты',
    'curator.ops.defaults': 'Формат обмена: JSON. При импорте дубликаты заменяются автоматически.',
    'curator.message.importSummary': 'Импорт выполнен. Всего: {total}, добавлено: {imported}, заменено: {replaced}, пропущено: {skipped}, невалидно: {invalid}.',
    'curator.message.exportGroup': 'Экспортировано {count} проверенных результатов для {userName}.',
    'curator.message.exportAll': 'Экспортировано проверенных результатов: {count}.',
    'curator.error.import': 'Не удалось импортировать ответы студентов.',
    'curator.error.noReviewed': 'Нет проверенных результатов для экспорта.',
    'curator.error.groupNoReviewed': 'У группы "{group}" нет проверенных результатов для передачи студенту.',

    // Profile
    'profile.title': 'Профиль и настройки',
    'profile.subtitle': 'Здесь собраны персональные настройки и операции с файлами.',
    'profile.name.title': 'Имя пользователя',
    'profile.name.label': 'Имя',
    'profile.name.placeholder': 'Введите имя',
    'profile.actions.saveName': 'Сохранить имя',
    'profile.settings.title': 'Основные настройки',
    'profile.settings.language': 'Язык интерфейса',
    'profile.settings.theme': 'Тема',
    'profile.settings.theme.light': 'Светлая',
    'profile.settings.theme.dark': 'Темная',
    'profile.settings.role': 'Роль',
    'profile.transfer.title': 'Параметры обмена',
    'profile.transfer.subtitle': 'Для простоты и совместимости используются единые значения по умолчанию.',
    'profile.transfer.export': 'Экспорт: единый JSON-файл (включая данные куратора)',
    'profile.transfer.import': 'Импорт: роли и данные определяются автоматически, дубликаты заменяются',
    'profile.logout.title': 'Выход из приложения',
    'profile.logout.description': 'При выходе будет автоматически сформирован backup JSON-файл профиля с вашими данными.',
    'profile.logout.howToReturn': 'Чтобы войти снова, на стартовой странице загрузите этот файл профиля или выберите пользователя из локального архива.',
    'profile.logout.action': 'Выйти и сохранить файл профиля',
    'profile.questionnaires.title': 'Локальные опросники',
    'profile.status.saved': 'Профиль обновлен.',
    'profile.status.language': 'Язык интерфейса обновлен.',
    'profile.status.theme': 'Тема обновлена.',
    'profile.status.role': 'Роль обновлена.',
    'profile.error.name.empty': 'Укажите имя.',
    'profile.error.name.short': 'Имя должно быть не короче 2 символов.',
  },
  
  en: {
    // Navigation
    'nav.home': 'Home',
    'nav.dashboard': 'My Results',
    'nav.admin': 'Administration',
    'nav.editor': 'Editor',
    'nav.translations': 'Translations',
    'nav.profile': 'Profile',
    
    // User setup
    'user.title': 'Welcome',
    'user.subtitle': 'Please introduce yourself to get started',
    'user.placeholder': 'Enter your name',
    'user.error.empty': 'Please enter your name',
    'user.error.short': 'Name must be at least 2 characters',
    'user.continue': 'Continue',
    'user.archive.title': 'Previously saved users',
    'user.archive.empty': 'User archive is empty.',
    'user.archive.select': 'Pick a user to continue without a backup file.',
    'user.archive.use': 'Continue as {name}',
    'user.archive.restoring': 'Restoring...',
    'user.archive.lastUsed': 'Last activity: {date}',
    'user.archive.role': 'Role: {role}',
    'user.archive.error': 'Failed to restore user from local archive.',
    'user.backup.title': 'Restore from profile file',
    'user.backup.description': 'Upload a saved profile file to restore data on this or another device.',
    'user.backup.success': 'Profile and data restored from the profile file.',
    'user.backup.error': 'Failed to load profile file.',
    
    // Questionnaire list
    'quiz.title': 'Hello, {name}!',
    'quiz.subtitle': 'Select a questionnaire to take',
    'quiz.questions': 'questions',
    'quiz.scale': 'Scale: 0-10',
    'quiz.start': 'Start Quiz',
    'quiz.noQuizzes': 'No questionnaires available',
    'quiz.loading.title': 'Loading questionnaires...',
    'quiz.loading.retrying': 'Retrying load ({attempt}/{max})',
    'quiz.loading.retryingHint': 'Checking questionnaires availability on the server.',
    'quiz.loading.partialTitle': 'Server questionnaires are temporarily unavailable',
    'quiz.loading.partialDescription': 'Only local questionnaires are shown. The list will refresh automatically once the server responds.',
    'quiz.loading.failedTitle': 'Could not load questionnaires',
    'quiz.loading.failedDescription': 'The server is not responding yet. Check your connection and try again.',
    'quiz.loading.autoRetry': 'Auto retry in {seconds}s.',
    'quiz.loading.retryButton': 'Retry now',
    'quiz.paused.title': 'You have a paused quiz',
    'quiz.paused.description': 'You can continue from where you left off',
    'quiz.paused.continue': 'Continue',
    
    // Quiz taker
    'quiz.question': 'Question',
    'quiz.of': 'of',
    'quiz.sources': 'Sources:',
    'quiz.selfCheck.show': 'Show self-check prompts',
    'quiz.selfCheck.hide': 'Hide prompts',
    'quiz.selfCheck.title': 'Self-check questions:',
    'quiz.score.select': 'Select score:',
    'quiz.score.selected': 'Selected',
    'quiz.score.preview': 'Preview',
    'quiz.comment.add': 'Add comment',
    'quiz.comment.required': 'Written comment is required for this question',
    'quiz.comment.requiredHint': 'Add a written comment to continue.',
    'quiz.comment.placeholder': 'Your thoughts, observations, comments...',
    'quiz.photo.add': 'Add photo',
    'quiz.photo.remove': 'Remove photo',
    'quiz.navigation.back': 'Back',
    'quiz.navigation.pause': 'Pause',
    'quiz.navigation.next': 'Next',
    'quiz.navigation.complete': 'Complete',
    
    // Dashboard
    'dashboard.title': 'Personal Dashboard',
    'dashboard.subtitle': 'View and manage your results',
    'dashboard.empty.title': 'No results yet',
    'dashboard.empty.description': 'Take a quiz to see your results here',
    'dashboard.results.count': 'My Results ({count})',
    'dashboard.export.all': 'Export All',
    'dashboard.score.total': 'Total Score',
    'dashboard.score.percentage': 'Percentage',
    'dashboard.answered': 'Answered',
    'dashboard.date': 'Date',
    'dashboard.export': 'Export',
    'dashboard.delete': 'Delete',
    'dashboard.import.button': 'Import Results',
    'dashboard.import.strategy.skip': 'Import: skip duplicates',
    'dashboard.import.strategy.replace': 'Import: replace duplicates',
    'dashboard.transfer.defaults': 'Default exchange format: JSON. Duplicate records are replaced on import.',
    'dashboard.import.success': 'Import completed. Total: {total}, added: {imported}, replaced: {replaced}, skipped: {skipped}, invalid: {invalid}.',
    'dashboard.import.error': 'Failed to import results.',
    'dashboard.report.create': 'Prepare attempt report',
    'dashboard.report.hide': 'Hide report',
    'dashboard.report.title': 'Attempt report: {title}',
    'dashboard.report.description': 'Report is generated for one attempt. Empty comments and photos are hidden.',
    'dashboard.report.download': 'Download',
    'dashboard.report.downloadMarkdown': 'Download text',
    'dashboard.report.downloadPlainText': 'Download plain text',
    'dashboard.report.downloadHtml': 'Download HTML',
    'dashboard.report.savePdf': 'Save PDF',
    'dashboard.report.savePdfHint': 'PDF is created through the browser print dialog. Choose "Save as PDF".',
    'dashboard.report.print': 'Print',
    'dashboard.report.close': 'Close report',
    'dashboard.report.preview': 'Report preview',
    'dashboard.report.error.print': 'Failed to open report print window.',
    'dashboard.report.error.pdf': 'Failed to generate the report PDF file.',
    'dashboard.group.summary': 'Attempts: {attempts} • Last date: {date}',
    'dashboard.group.overall': 'Overall questionnaire score',
    'dashboard.group.history': 'Questionnaire attempt history',
    'dashboard.group.absentQuestions': 'Questions missing in the current version are marked with a colored border.',
    'dashboard.group.absentBadge': 'missing in current version',
    'dashboard.group.openQuestionnaire.action': 'Edit questionnaire',
    'dashboard.group.openQuestionnaire.errorSchema': 'Questionnaire for editing this attempt was not found.',
    'dashboard.tab.results': 'Results',
    'dashboard.tab.analytics': 'Analytics',
    'dashboard.tab.feedback': 'Feedback',
    'dashboard.analytics.title': 'Dynamics analytics',
    'dashboard.analytics.subtitle': 'Separate tab for trend analysis and question-level history.',
    'dashboard.analytics.usage': 'Opened total times: {count}',
    'dashboard.analytics.filter.questionnaire': 'Questionnaire',
    'dashboard.analytics.filter.period': 'Quick range',
    'dashboard.analytics.filter.quickPeriod': 'Quick buttons',
    'dashboard.analytics.filter.from': 'From',
    'dashboard.analytics.filter.to': 'To',
    'dashboard.analytics.filter.quick7': '7 days',
    'dashboard.analytics.filter.quick30': '30 days',
    'dashboard.analytics.filter.quickAll': 'All time',
    'dashboard.analytics.filter.rangePlaceholder': 'Select date range',
    'dashboard.analytics.filter.clear': 'Clear',
    'dashboard.analytics.emptyByFilter': 'No results for the selected questionnaire and period.',
    'dashboard.analytics.rangeInvalid': 'Start date is later than end date. Check the range.',
    'dashboard.feedback.title': 'Curator feedback',
    'dashboard.feedback.subtitle': 'Separate tab with curator comments and student replies history.',
    'dashboard.feedback.empty': 'No curator feedback found in imported results yet.',
    'dashboard.feedback.question': 'Question {index}',
    'dashboard.feedback.thread': 'Conversation',
    'dashboard.feedback.reply.placeholder': 'Your reply to curator, clarification or addition...',
    'dashboard.feedback.reply.save': 'Save student reply',
    'dashboard.feedback.comment.label': 'Student description for answer',
    'dashboard.feedback.comment.placeholder': 'Add or update your answer description...',
    'dashboard.feedback.comment.save': 'Save description',
    'dashboard.feedback.author.curator': 'Curator',
    'dashboard.feedback.author.student': 'Student',
    'dashboard.feedback.saved': 'Changes saved.',
    'dashboard.feedback.openQuestion.action': 'Open question',
    'dashboard.feedback.openQuestion.errorSchema': 'Questionnaire for editing this question was not found.',
    'dashboard.feedback.openQuestion.errorQuestion': 'Answer for this question was not found in result.',

    // Admin dashboard
    'admin.title': 'Administration',
    'admin.subtitle': 'Unified profile for questionnaires, translations, and migration/reconciliation operations.',
    'admin.tab.overview': 'Overview',
    'admin.tab.questionnaires': 'Questionnaires',
    'admin.tab.translations': 'Translations',
    'admin.tab.operations': 'Migrations & Reconciliation',
    'admin.ops.migrations.title': 'Data Migrations',
    'admin.ops.migrations.description': 'Force-run local storage migrations.',
    'admin.ops.migrations.run': 'Run migrations',
    'admin.ops.status.migrations.success': 'Migrations completed successfully.',
    'admin.ops.error.migrations.failed': 'Failed to run migrations.',
    'admin.ops.reconciliation.title': 'Import Reconciliation (dry-run)',
    'admin.ops.reconciliation.description': 'Validate imported results file against current questionnaire schemas before import.',
    'admin.ops.reconciliation.file': 'Results file',
    'admin.ops.error.reconciliation.emptyFile': 'The file does not contain results for reconciliation.',
    'admin.ops.status.reconciliation.completed': 'Reconciliation completed. Results checked: {total}. Compatible: {compatible}.',
    'admin.ops.error.reconciliation.failed': 'Failed to reconcile imported results.',
    'admin.ops.report.totalResults': 'Results in file: {count}',
    'admin.ops.report.compatibleResults': 'Compatible: {count}',
    'admin.ops.report.incompatibleResults': 'Incompatible: {count}',
    'admin.ops.report.missingQuestionnaires': 'Missing questionnaires: {count}',
    'admin.ops.report.missingQuestions': 'Missing questions: {count}',
    'admin.overview.editor.description': 'Create, edit, and upload questionnaires without redeploy.',
    'admin.overview.translation.description': 'Edit and export interface localization files.',
    'admin.overview.operations.description': 'Run migrations and dry-run reconciliation for imported results.',

    // Questionnaire editor
    'editor.title': 'Questionnaire Editor',
    'editor.subtitle': 'Create, edit, and upload questionnaires. New files are normalized to the 0..10 scale.',
    'editor.loadExisting': 'Load existing',
    'editor.loadExisting.placeholder': 'Select questionnaire...',
    'editor.import': 'Import file',
    'editor.meta.title': 'Title',
    'editor.meta.title.placeholder': 'Quality assessment...',
    'editor.meta.source': 'Source',
    'editor.meta.source.placeholder': 'Lecture / text',
    'editor.meta.quality': 'Questionnaire code',
    'editor.languages.title': 'Question languages:',
    'editor.languages.remove.aria': 'Remove language {language}',
    'editor.languages.new.placeholder': 'New language code (for example, es)',
    'editor.languages.hint': 'When a language is added, translation fields appear for every question.',
    'editor.languages.add': '+ Add language',
    'editor.question.title': 'Question {index}',
    'editor.question.delete': 'Delete',
    'editor.question.id': 'Question code',
    'editor.question.requiresComment': 'Require written comment for this question',
    'editor.question.localized': 'Question ({language})',
    'editor.question.contextSources': 'Context (one per line)',
    'editor.question.selfCheckPrompts': 'Self-check prompts (one per line)',
    'editor.error.language.empty': 'Provide a language code.',
    'editor.error.language.invalid': 'Invalid language code. Use formats like ru, en, es, pt-br.',
    'editor.error.language.duplicate': 'Language "{language}" is already added.',
    'editor.status.language.added': 'Language "{language}" added to editor.',
    'editor.error.language.last': 'Cannot remove the last language.',
    'editor.status.language.removed': 'Language "{language}" removed from editor.',
    'editor.status.saved': 'Questionnaire "{title}" saved to local storage.',
    'editor.status.exported': 'Questionnaire file exported.',
    'editor.status.imported': 'File "{fileName}" loaded into editor.',
    'editor.error.deleteCustom.qualityMissing': 'Provide quality identifier before deletion.',
    'editor.status.deleteCustom.success': 'Custom questionnaire "{quality}" removed from local registry.',
    'editor.actions.addQuestion': '+ Add question',
    'editor.actions.save': 'Save to app',
    'editor.actions.export': 'Export file',
    'editor.actions.deleteCustom': 'Delete custom',
    'editor.actions.reset': 'Reset form',

    // Translation manager
    'translation.title': 'UI Translation Tool',
    'translation.subtitle': 'Standalone tool for generating and saving interface localization files.',
    'translation.language': 'Language',
    'translation.language.option.ru': 'Russian',
    'translation.language.option.en': 'English',
    'translation.translator': 'Translator',
    'translation.translator.placeholder': 'Translator name',
    'translation.import': 'Load translation file',
    'translation.json': 'Translation text (view and edit)',
    'translation.status.currentLoaded': 'Current translations "{language}" loaded into editor.',
    'translation.status.loadedForLanguage': 'Loaded current translations for language "{language}".',
    'translation.status.fileDownloaded': 'Translation file generated and downloaded.',
    'translation.status.fileLoaded': 'Translation file loaded into editor.',
    'translation.error.invalidJson': 'Invalid JSON in translation editor.',
    'translation.error.fileRead': 'Failed to read translation file.',
    'translation.status.importMeta': 'Imported: {fileName} | translator: {translator} | version: {version}',
    'translation.keys.title': 'Key validation',
    'translation.keys.noneMissing': 'No missing keys found.',
    'translation.actions.loadCurrent': 'Load current',
    'translation.actions.save': 'Save translation file',
    'translation.actions.exportAll': 'Export all translations',
    'translation.audit.title': 'Form Translation Coverage Audit',
    'translation.audit.summary': 'Forms: {forms} • Fully covered: {covered} • Missing keys (ru+en): {missing}',
    'translation.audit.missingRu': 'Missing RU entries: {count}',
    'translation.audit.missingEn': 'Missing EN entries: {count}',
    'translation.audit.exportCoverage': 'Download coverage report',
    'translation.audit.table.form': 'Form',
    'translation.audit.table.keys': 'Keys',
    'translation.audit.table.missingRu': 'Missing RU',
    'translation.audit.table.missingEn': 'Missing EN',
    'translation.audit.table.status': 'Status',
    'translation.audit.status.ok': 'OK',
    'translation.audit.status.needsWork': 'Needs i18n work',

    // Questionnaire loader
    'loader.title': 'Questionnaire Upload',
    'loader.subtitle': 'Add questionnaire file without redeploying the app.',
    'loader.actions.downloadTemplate': 'Download template',
    'loader.actions.upload': 'Upload file',
    'loader.status.success': 'Questionnaire "{title}" uploaded and available in the list.',
    'loader.status.error': 'Failed to load questionnaire file.',

    // Score chart
    'chart.distribution.title': 'Score distribution on 0..10 scale',
    'chart.distribution.subtitle': 'The full grading scale with description for each score is used.',
    'chart.timeline.title': 'Overall daily dynamics',
    'chart.timeline.subtitle': 'Calendar navigation by daily average score across all answers.',
    'chart.timeline.hint': 'Click a day in the calendar to inspect that date in detail.',
    'chart.timeline.empty': 'No completed questionnaires for the selected month.',
    'chart.timeline.summary': '{date} • Average score: {score}/10 ({grade}). Attempts: {attempts} • Recorded scores: {answersCount}',
    'questionStats.title': 'Question-level dynamics for selected questionnaire',
    'questionStats.subtitle': 'Only questions with at least two scores in the selected period are shown.',
    'questionStats.select': 'Select questionnaire for question dynamics',
    'questionStats.empty': 'No data for selected questionnaire.',
    'questionStats.metric.id': 'ID',
    'questionStats.metric.average': 'Average score',
    'questionStats.metric.last': 'Last score',
    'questionStats.metric.attempts': 'Attempts',
    'questionStats.metric.delta': 'Change',
    'questionStats.dynamics.title': 'Score change history',
    'questionStats.dynamics.noData': 'No questions with two or more scores for the selected period yet.',
    'questionStats.lowData.title': 'Questions with limited data ({count})',
    'questionStats.lowData.item': '{question} — attempts: {attempts}',
    
    // Grading scale
    'grade.0': 'never thought about it (lack of awareness)',
    'grade.1': 'when I remember, I try, but it is too late',
    'grade.2': 'almost never works',
    'grade.3': 'often almost does not work',
    'grade.4': 'rarely works, requires huge effort',
    'grade.5': 'I try, it does not always work (50/50)',
    'grade.6': 'works more often than not',
    'grade.7': 'sometimes works stably (confident practice)',
    'grade.8': 'works in most cases',
    'grade.9': 'almost always works',
    'grade.10': 'always (perfection)',
    
    // Common
    'common.loading': 'Loading...',
    'common.close': 'Close',
    'common.save': 'Save',
    'common.cancel': 'Cancel',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.back': 'Back',
    'markdown.toolbar.bold': 'Bold',
    'markdown.toolbar.italic': 'Italic',
    'markdown.toolbar.bulletList': 'Bullet list',
    'markdown.toolbar.orderedList': 'Numbered list',
    'markdown.toolbar.image': 'Insert image',
    'markdown.toolbar.undo': 'Undo',
    'markdown.toolbar.redo': 'Redo',
    'header.role.student': 'Student',
    'header.role.curator': 'Curator',
    'header.role.admin': 'Admin',
    'header.logout': 'Logout',
    'header.loggingOut': 'Logging out...',
    'header.logoutError': 'Failed to export data and end the session.',
    'header.logoutConfirmTitle': 'Confirm logout',
    'header.logoutConfirm': 'Are you sure you want to log out?',
    'header.logoutContinue': 'Continue',
    'header.logoutStay': 'Stay',
    'header.logoutBackupTitle': 'Save the profile file',
    'header.logoutSaveWarning': 'A profile file (backup JSON) will be downloaded. Save it and do not cancel the download: you can upload this file on another device to restore your data.',
    'header.logoutBackupAction': 'Download and logout',
    'access.denied.title': 'Access restricted',
    'access.denied.editorOnlyAdmin': 'Questionnaire editor is available only for the admin role.',
    'access.denied.translationsOnlyAdmin': 'Translation panel is available only for the admin role.',
    'pwa.updates.title': 'New questionnaires are available',
    'pwa.updates.body': 'New questionnaires were published on the server ({count}): {names}.',

    // Curator dashboard
    'curator.title': 'Curator Dashboard',
    'curator.subtitle': 'Review student answers grouped by questionnaire and student.',
    'curator.metrics.totalAnswers': 'Total Answers',
    'curator.metrics.groupCount': 'Task Groups',
    'curator.metrics.pending': 'Pending Review',
    'curator.metrics.reviewed': 'Reviewed',
    'curator.metrics.averageScore': 'Average Score',
    'curator.section.activeGroups': 'Groups With Active Review ({count})',
    'curator.section.completedGroups': 'Completed Review Groups ({count})',
    'curator.empty.activeGroups': 'No active groups waiting for review.',
    'curator.group.summary': 'Attempts: {total} • Pending: {pending} • Reviewed: {reviewed}',
    'curator.group.reviewedSummary': 'Reviewed attempts: {count}',
    'curator.status.pending': 'Pending Review',
    'curator.status.inReview': 'In Review',
    'curator.status.reviewed': 'Reviewed',
    'curator.status.needsRevision': 'Needs revision',
    'curator.status.approved': 'Needs revision',
    'curator.actions.hide': 'Hide',
    'curator.actions.review': 'Review',
    'curator.actions.markReviewed': 'Mark as reviewed',
    'curator.actions.requestRevision': 'Request revision',
    'curator.actions.approve': 'Request revision',
    'curator.question.label': 'Question {index}:',
    'curator.question.absent': 'missing in current version',
    'curator.schema.absentQuestions': 'Questions missing in current questionnaire version: {questions}',
    'curator.comment.student': 'Student comment:',
    'curator.photos.attached': 'Attached photos:',
    'curator.feedback.add': '+ Add feedback',
    'curator.feedback.send': 'Send',
    'curator.feedback.cancel': 'Cancel',
    'curator.feedback.placeholder': 'Your comment, questions, additions...',
    'curator.ops.exportFormat': 'Export format',
    'curator.ops.importStrategy': 'Import strategy',
    'curator.ops.exportAllReviewed': 'Export all reviewed',
    'curator.ops.importStudentAnswers': 'Import student answers',
    'curator.ops.exportForStudent': 'Export reviewed for student',
    'curator.ops.export.json': 'JSON',
    'curator.ops.export.csv': 'CSV',
    'curator.ops.import.skip': 'Skip duplicates',
    'curator.ops.import.replace': 'Replace duplicates',
    'curator.ops.defaults': 'Exchange format: JSON. Duplicate records are replaced on import.',
    'curator.message.importSummary': 'Import completed. Total: {total}, added: {imported}, replaced: {replaced}, skipped: {skipped}, invalid: {invalid}.',
    'curator.message.exportGroup': 'Exported {count} reviewed results for {userName}.',
    'curator.message.exportAll': 'Exported reviewed results: {count}.',
    'curator.error.import': 'Failed to import student answers.',
    'curator.error.noReviewed': 'No reviewed results available for export.',
    'curator.error.groupNoReviewed': 'Group "{group}" has no reviewed results to transfer.',

    // Profile
    'profile.title': 'Profile & settings',
    'profile.subtitle': 'Personal settings and file operations are grouped here.',
    'profile.name.title': 'User name',
    'profile.name.label': 'Name',
    'profile.name.placeholder': 'Enter name',
    'profile.actions.saveName': 'Save name',
    'profile.settings.title': 'Basic settings',
    'profile.settings.language': 'Interface language',
    'profile.settings.theme': 'Theme',
    'profile.settings.theme.light': 'Light',
    'profile.settings.theme.dark': 'Dark',
    'profile.settings.role': 'Role',
    'profile.transfer.title': 'Data transfer defaults',
    'profile.transfer.subtitle': 'Unified defaults are used to keep transfers simple and compatible.',
    'profile.transfer.export': 'Export: single JSON file (includes curator data)',
    'profile.transfer.import': 'Import: roles/data are detected automatically, duplicates are replaced',
    'profile.logout.title': 'Sign out',
    'profile.logout.description': 'On sign out, the app will automatically generate a backup JSON profile file with your data.',
    'profile.logout.howToReturn': 'To sign in again, upload this profile file on the start screen or choose a user from the local archive.',
    'profile.logout.action': 'Sign out and save profile file',
    'profile.questionnaires.title': 'Local questionnaires',
    'profile.status.saved': 'Profile updated.',
    'profile.status.language': 'Language updated.',
    'profile.status.theme': 'Theme updated.',
    'profile.status.role': 'Role updated.',
    'profile.error.name.empty': 'Name is required.',
    'profile.error.name.short': 'Name must be at least 2 characters.',
  },
};

type LanguageListener = (language: LanguageCode) => void;

const languageListeners = new Set<LanguageListener>();

function notifyLanguageChange(): void {
  for (const listener of languageListeners) {
    listener(currentLanguage);
  }
}

function readStoredLanguage(): LanguageCode | null {
  if (typeof window === 'undefined') {
    return null;
  }

  const saved = localStorage.getItem('app-language') as LanguageCode | null;
  if (saved && translations[saved]) {
    return saved;
  }

  return null;
}

let currentLanguage: LanguageCode = 'ru';

export function setLanguage(lang: LanguageCode): void {
  if (!translations[lang]) {
    return;
  }

  if (lang === currentLanguage) {
    return;
  }

  currentLanguage = lang;

  if (typeof window !== 'undefined') {
    localStorage.setItem('app-language', lang);
  }

  notifyLanguageChange();
}

export function getLanguage(): LanguageCode {
  return currentLanguage;
}

export function initializeLanguage(): void {
  const saved = readStoredLanguage();
  if (saved && saved !== currentLanguage) {
    currentLanguage = saved;
    notifyLanguageChange();
  }
}

export function subscribeLanguage(listener: LanguageListener): () => void {
  languageListeners.add(listener);

  return () => {
    languageListeners.delete(listener);
  };
}

export function t(key: keyof TranslationKeys, params?: Record<string, string | number>): string {
  const translation = translations[currentLanguage][key] || translations['en'][key] || key;
  
  if (params) {
    return Object.entries(params).reduce((acc, [paramKey, value]) => {
      return acc.replace(new RegExp(`{${paramKey}}`, 'g'), String(value));
    }, translation);
  }
  
  return translation;
}

export function getGradeDescription(score: number): string {
  const key = `grade.${score}` as keyof TranslationKeys;
  return t(key);
}
