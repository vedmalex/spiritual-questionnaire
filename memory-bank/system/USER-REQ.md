# USER-REQ — Критерии Сверки

> Источник: прямой запрос пользователя в чате (сформулирован как эталон требований).
> Этот файл является основным критерием сверки реализации.

## 1. Цель продукта
Создать изолированное web-приложение (для статического хостинга), которое загружает опросники из статических файлов, дает пользователю пройти опрос и выгружает результаты в текстовых форматах.

## 2. Технологический стек и ограничения
- Обязательно использовать `TanStack Start`.
- Обязательно использовать `TailwindCSS`.
- Приложение должно быть пригодно для статического хостинга.
- Данные должны храниться локально (без обязательного сервера на текущем этапе).
- Доступ к данным должен идти через адаптеры, чтобы позже можно было подключить сервер.

## 3. Пользовательский сценарий
1. Пользователь вводит имя.
2. Пользователь выбирает роль.
3. Пользователь выбирает опросник.
4. Пользователь отвечает на вопросы.
5. Пользователь может поставить опрос на паузу и продолжить позже.
6. При случайной перезагрузке страницы текущая сессия восстанавливается.
7. Пользователь видит локально сохраненные данные и историю прохождений.

## 4. Обязательные функциональные требования

### 4.1 Профиль и роли
- Выбор роли при входе обязателен.
- Пользователь может менять роль во время работы с сайтом.
- Выполнение задания должно быть артефактом передачи между студентом и куратором.
- Пользователь может выйти из приложения и войти снова.
- При выходе вся пользовательская информация должна выгружаться в файл для дальнейшего использования.
- Результаты студента и результаты, загруженные/обрабатываемые куратором, должны храниться раздельно и не смешиваться.
- В режиме куратора не должны отображаться личные результаты текущего пользователя из режима студента.
- При выходе, если профиль куратора содержит данные (импортированные/проверенные ответы), должен выгружаться отдельный backup-файл профиля куратора.

### 4.2 Опросники
- Выбор опросника из списка.
- Поддержка структуры опросника из skill `spiritual-questionnaire-architect`.
- В схеме вопроса должна быть возможность хранить формулировку вопроса на нескольких языках.
- Нужен инструмент создания/редактирования опросников.
- Опросники должны загружаться в приложение без обновления приложения на статическом хостинге.
- Пользователь может локально добавлять собственные опросники и использовать их без участия сервера.
- Локально добавленные опросники должны поддерживать выгрузку/загрузку для обмена между пользователями.
- Пользователь может выгружать локальные опросники для передачи разработчику (предложение новых материалов для публикации).
- В схеме вопроса должен поддерживаться флаг обязательности письменного комментария (`requires_comment`).
- В редакторе опросника при переключении языка должны появляться поля вопроса для выбранных языков.
- В редакторе опросника должны поддерживаться дополнительные языки: можно добавить язык и заполнить недостающие поля перевода.

### 4.3 Прохождение и ответы
- Ответ по шкале 0..10.
- Возможность добавлять письменные дополнения к ответу.
- Если у вопроса указан `requires_comment: true`, переход к следующему вопросу/завершению опроса возможен только при заполненном комментарии.
- Возможность прикладывать фотографии к ответу.
- По наведению на шкалу должна отображаться расшифровка оценки.

### 4.4 Хранение, устойчивость, миграции
- Все данные сохраняются локально.
- Восстановление текущей сессии после перезагрузки страницы.
- Приложение размещается на статическом хостинге, публикацию новой версии выполняет разработчик.
- Наличие миграций при изменении схемы данных.
- Наличие миграций структуры опросников:
  - добавленные вопросы должны добавляться в рабочую структуру;
  - удаленные вопросы не удаляются из исторических результатов, а помечаются как отсутствующие в новой версии.
- Миграция должна запускаться при несовпадении локальной версии данных/опросника с версией из приложения.
- Для определения смены версии должен использоваться ключ версии сборки (build id/hash).
- При миграции из-за смены версии или структуры пользовательский прогресс не должен теряться.
- При объединении данных из разных источников должна выполняться миграция/сверка с правилами дедупликации и разрешения конфликтов.
- Сверка (reconciliation) данных должна выполняться до загрузки импортируемых результатов.

### 4.5 Дашборд и аналитика
- Dashboard со всеми оценками и тестами пользователя.
- История прохождения опросов.
- Просмотр результатов должен выполняться по опроснику (группировка истории по каждому опроснику).
- На dashboard должна выводиться общая оценка по каждому опроснику: словами и баллом.
- Пользователь может выбрать опросник и сформировать оформленный отчет для чтения (вопросы, баллы, письменные комментарии, фото).
- Для каждого опроса сохраняется дата прохождения.
- Статистика по бальности по каждому опросу в виде простого графика.
- Статистика по оценкам одного выбранного опроса по списку вопросов (для самооценки студента).
- Динамика для самооценки должна отображаться на уровне конкретного вопроса: название вопроса + история изменения его оценки во времени.
- График динамики вопроса показывается только если по этому вопросу есть минимум две оценки.
- Для навигации по истории оценок должно поддерживаться календарное представление.
- Во всех графиках и аналитике нужно использовать шкалу из USER-REQ (0..10 с полным описанием), без обобщений вида "низко/средне/высоко".

### 4.6 Экспорт
- Экспорт результатов минимум в двух форматах.
- Если к ответу приложена фотография, фото должно попадать в экспорт.
- Пользователь может выгружать все свои результаты одним файлом для переноса.
- Пользователь может загружать (импортировать) ранее выгруженные все результаты для переноса между устройствами.
- Отчет должен формироваться отдельно по каждой завершенной оценке (каждому прохождению), а не агрегированно по всему опроснику.
- В отчете не нужно выводить `ID` вопроса.
- В отчете не нужно выводить пустые блоки комментария/фото (если данных нет).
- Должен быть экспорт отчета в формате «Скачать текст» (читаемая версия с оформлением).
- Должен быть отдельный экспорт «Скачать текст без оформления» (plain text).
- Для того же отчета должен поддерживаться print-friendly вывод (печать из того же шаблона отчета).
- В блоке отчета должен быть прямой клиентский экспорт в PDF (без сервера).
- Кнопка печати отчета должна стабильно открывать системный print flow без pop-up блокировок.

### 4.7 Проверка куратором
- Нужен интерфейс просмотра ответов студентов.
- Задания/ответы в интерфейсе куратора должны быть сгруппированы (по опроснику и студенту).
- Куратор может оставлять обратную связь, дополнения и вопросы.
- Куратор может загружать ответы студентов из файла для последующей проверки.
- Куратор может выгружать результаты проверки (с комментариями/вопросами куратора) для передачи студентам.
- Это должно быть отражено в схеме сохраняемого результата.

### 4.8 Локализация и перевод
- Локализация интерфейса обязательна.
- Нужен отдельный инструмент перевода UI, который сохраняет перевод в файл.
- Все новые формы должны проектироваться сразу с учетом мультиязычности (i18n-first).
- Панель перевода должна подгружать уже существующие переводы, а также позволять редактировать и добавлять новые.
- Пользователь может локально добавлять/редактировать переводы и выгружать их для обмена.
- Пользователь может выгружать локальные переводы для передачи разработчику (предложение улучшений локализации).
- Нужна отдельная проверка покрытия переводов для всех форм приложения.

### 4.9 Администрирование и workflow
- Нужен профиль `admin` (администрирование) с единым доступом к:
  - составлению/редактированию опросников;
  - настройкам переводов;
  - операциям миграции/сверки данных перед импортом результатов.
- Workflow работы с проектом должен фиксировать обязательные этапы:
  - i18n-проектирование новых форм;
  - обновление переводов;
  - миграции схем;
  - pre-load reconciliation;
  - проверка использования шкалы USER-REQ в UI и аналитике.

### 4.10 UX/Дизайн
- Стиль интерфейса: профессиональный для образовательных учреждений.
- Интерфейс должен быть mobile-friendly.
- Предусмотреть выбор темы.
- На мобильном и desktop роль/язык должны использовать консистентные контролы (без отдельных mobile `select`/combo-box).
- В шапке клик по имени пользователя должен открывать страницу профиля.
- В шапке клик/тап по названию приложения должен вести на главную страницу.
- В списках вопросов на формах просмотра результатов заголовок вопроса должен отображаться в одну строку с многоточием; видимая длина заголовка должна адаптироваться к ширине экрана (чем меньше экран, тем короче видимая часть).
- В карточке результата кнопки действий (редактирование/отчет/экспорт/удаление) должны располагаться над списком вопросов и отображаться в одну линию с переносом на следующую строку только при нехватке ширины.

### 4.11 Аналитика использования
- Нужна интеграция Google Analytics (GA) для отслеживания пользовательской активности по страницам/формам.

## 5. Обязательная шкала оценивания

В каждый JSON-файл опросника нужно внедрять **точно** это описание:
- **0**: не задумывался (отсутствие осознанности)
- **1**: когда вспоминаю, стараюсь, но уже поздно
- **2**: почти никогда не получается
- **3**: часто почти не получается
- **4**: получается редко, требует огромных усилий
- **5**: стараюсь, получается не всегда (50/50)
- **6**: получается чаще, чем не получается
- **7**: иногда получается стабильно (уверенная практика)
- **8**: получается в большинстве случаев
- **9**: почти всегда получается
- **10**: всегда (совершенство)

## 6. Матрица критериев (UR-ID)
- `UR-001`: Статический web app + статические файлы опросников.
- `UR-002`: Ввод имени пользователя.
- `UR-003`: Выбор роли при входе.
- `UR-004`: Смена роли во время работы.
- `UR-005`: Выбор опросника.
- `UR-006`: Ответы по шкале 0..10.
- `UR-007`: Письменные дополнения к ответу.
- `UR-008`: Фото в ответе.
- `UR-009`: Tooltip шкалы при наведении.
- `UR-010`: Локальное хранение.
- `UR-011`: Восстановление сессии после перезагрузки.
- `UR-012`: Pause/Resume.
- `UR-013`: Dashboard с результатами и историей.
- `UR-014`: Дата прохождения опроса.
- `UR-015`: График статистики по бальности.
- `UR-016`: Экспорт в 2+ формата.
- `UR-017`: Экспорт фото вместе с результатами.
- `UR-018`: Адаптеры данных (готовность к серверу).
- `UR-019`: Миграции схемы данных.
- `UR-020`: Локализация UI.
- `UR-021`: Инструмент перевода UI с сохранением в файл.
- `UR-022`: Многоязычный текст вопроса в схеме.
- `UR-023`: Кураторский просмотр ответов.
- `UR-024`: Кураторская обратная связь в данных результата.
- `UR-025`: Артефакт передачи student ↔ curator.
- `UR-026`: Профессиональный стиль для образовательной среды.
- `UR-027`: Mobile-friendly интерфейс.
- `UR-028`: Выбор темы.
- `UR-029`: Редактор опросников (создание/редактирование).
- `UR-030`: Динамическая загрузка опросников без redeploy.
- `UR-031`: Шкала 0..10 внедрена в каждый JSON-файл опросника.
- `UR-032`: Выгрузка всех результатов пользователя для переноса.
- `UR-033`: Загрузка (импорт) полного набора результатов пользователя из файла.
- `UR-034`: Статистика по выбранному опроснику на уровне списка вопросов, включая динамику по каждому вопросу.
- `UR-035`: Все новые формы проектируются по i18n-first подходу.
- `UR-036`: Профиль `admin` с управлением опросниками/переводами/операциями сверки.
- `UR-037`: Панель переводов загружает существующие переводы и поддерживает edit/add.
- `UR-038`: Проверка покрытия переводов по всем формам.
- `UR-039`: В редакторе опросников переключение/добавление языков создает и отображает соответствующие поля вопросов.
- `UR-040`: Миграция опросников учитывает добавленные и удаленные вопросы без потери исторических данных.
- `UR-041`: Сверка данных выполняется до загрузки (импорта) результатов.
- `UR-042`: Во всех графиках и аналитике используется полная шкала USER-REQ без категорий "низко/средне/высоко".
- `UR-043`: Просмотр результатов выполняется по опроснику; dashboard показывает общую оценку по опроснику словами и баллом.
- `UR-044`: При выходе пользовательские данные выгружаются в backup файл и могут быть восстановлены при повторном входе.
- `UR-045`: Локально добавленные опросники поддерживают импорт/экспорт для обмена между устройствами и пользователями.
- `UR-046`: Локально добавленные переводы поддерживают импорт/экспорт для обмена.
- `UR-047`: Миграция запускается при несовпадении локальной версии и версии приложения, с сохранением прогресса.
- `UR-048`: Используется build id/hash (ключ версии сборки) для определения необходимости миграции.
- `UR-049`: Объединение данных из разных источников выполняется через reconciliation с дедупликацией и разрешением конфликтов.
- `UR-050`: Графики показывают динамику оценок во времени на уровне конкретного вопроса.
- `UR-051`: Для навигации по динамике используется календарное представление.
- `UR-052`: Локальные опросники и переводы можно выгружать для передачи разработчику как предложение к публикации.
- `UR-053`: В панели куратора задания/ответы сгруппированы по опроснику и студенту.
- `UR-054`: Куратор может импортировать ответы студентов из файла для проверки.
- `UR-055`: Куратор может экспортировать проверенные результаты для передачи студенту.
- `UR-056`: Вопрос поддерживает `requires_comment`; при `true` письменный комментарий обязателен для продолжения.
- `UR-057`: Пользователь может сформировать отчет по выбранному опроснику (readable view + Markdown + print) с включением фото, комментариев и баллов.
- `UR-058`: Результаты режима студента и куратора хранятся в отдельных локальных хранилищах без смешивания.
- `UR-059`: При logout выгружается отдельный backup профиля куратора, если есть кураторские данные.
- `UR-060`: Отчет формируется по отдельной оценке (отдельному прохождению).
- `UR-061`: Отчет не показывает `ID` вопроса и не выводит пустые блоки комментария/фото.
- `UR-062`: В UI отчета используются названия «Скачать текст» и «Скачать текст без оформления».
- `UR-063`: Доступен отдельный экспорт plain text без форматирования.
- `UR-064`: Интегрирована Google Analytics аналитика переходов/активности по формам.
- `UR-065`: Поля письменных дополнений/обратной связи поддерживают полноценное редактирование текста через markdown-редактор (включая корректную работу курсора и правки внутри текста).
- `UR-066`: Отображение markdown в UI и отчетах выполняется через безопасный рендеринг без исполнения JS/вредоносных URI (XSS-hardening).
- `UR-067`: Перед logout показывается подтверждение выхода и отдельное предупреждение о необходимости сохранить backup-файл.
- `UR-068`: При logout создается локальный архив профиля/данных; на экране входа доступен выбор ранее сохраненного пользователя для восстановления.
- `UR-069`: Отдельное поле «прикрепить фото» в ответе убирается; изображения добавляются внутри markdown-редактора и сохраняются в ответе.
- `UR-070`: Тулбар markdown-редактора должен использовать иконки (вместо технических текстовых сокращений), сохраняя headless-подход.
- `UR-071`: Подтверждение выхода и предупреждение о backup должны отображаться в UI-стиле приложения (не browser confirm/alert) с пояснением, что это файл профиля для восстановления на другом устройстве.
- `UR-072`: Предпросмотр отчета отображается внутри секции результатов (рядом с выбранной попыткой), поддерживаются клиентские экспорты HTML и PDF (через print-dialog браузера).
- `UR-073`: В блоке отчета используется компактный набор действий: одна кнопка «Скачать» с выпадающим выбором формата сохранения и одна кнопка «Печать».
- `UR-074`: Кнопка выхода размещается на странице профиля и сопровождается текстовым пояснением о том, что произойдет при выходе и как войти снова.
- `UR-075`: В блоке отчета доступен прямой клиентский экспорт PDF (без серверной генерации).
- `UR-076`: Кнопка печати отчета открывает стабильный print flow (без зависимости от pop-up window).
- `UR-077`: На мобильных/desktop роль и язык переключаются единым консистентным UI без mobile `select`/combo-box.
- `UR-078`: В Header имя пользователя кликабельно и ведет в профиль, а название приложения ведет на главную страницу.
- `UR-079`: Переходы «Результаты/Профиль» доступны через dropdown-меню по клику на блок пользователя, что сокращает размер основной верхней навигации.
- `UR-080`: Подготовка отчета к печати/PDF не зависит от текущей темы приложения; документ всегда формируется в читаемом светлом стиле.
- `UR-081`: В списках вопросов при просмотре результатов заголовок сокращается в одну строку с многоточием и адаптивной длиной по ширине экрана.
- `UR-082`: В карточке результата кнопки действий размещаются над списком вопросов, в одной горизонтальной линии с адаптивным переносом при нехватке ширины.

Last Updated: 2026-02-12 14:40
